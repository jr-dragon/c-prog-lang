# 第 1 章：簡介

在本書的開篇，我們會概要性地介紹 C 語言。主要會通過實際的範例讓讀者理解一些 C 語言的基本元素，但對於具體的細節、規則或例外情況會暫且按下不表，而是希望讀者能盡快上手並且撰寫出有用的程序（畢竟大家都沒什麼耐心，對吧？）。

本章將會介紹一些基本概念：
- 變數
- 算術運算
- 流程控制
- 函式
- 基本輸入與輸出

而對於一些編寫較大型應用程式常會涉及到的一些重要特性，如指標、結構或一些巨集等就不在本章的討論範圍內。

## 1.1 入門

一般來說，程式設計師們習慣使用 `Hello World` 程式來作為開篇，當計算機能夠正常在螢幕上輸出 `Hello World` 時，往往代表著開發工具已經準備就緒。

### 1.1.1 撰寫程式碼

在 C 語言中，我們可以用以下程式碼使程式輸出 `Hello World`:

```c
#include <stdio.h>

int main() {
    puts("Hello World");
}
```

讀者可以在任何純文字編輯器中輸入這段程式，並且儲存為 `hello.c` 的純文字檔案。

:::info
在本課程中，讀者可以選擇任何偏愛的純文字編輯器。

如果不曉得如何選擇，可以使用由 Microsoft 公司推出的開放原始碼純文字編輯器 [Visual Studio Code](https://code.visualstudio.com/)，它可以在各種不同的作業系統中被使用，同時也是被廣泛接受的選擇。
:::

### 1.1.2 從程式碼到程式

為了使上一節的程式碼成為可執行的程式，程式設計師通常會依賴名為 _編譯器（Compiler）_ 的特殊程式，它能夠藉由 _編譯（Compile）_ 將程式碼翻譯為計算機能夠理解並執行的機器碼。

在部份 Linux 作業系統中，我們可以使用 `cc` 來編譯程式碼：

```bash
cc hello.c
```

:::info
在不同的作業系統中，往往有著迥異的編譯器與行為，為了降低學習上的門檻與困擾，本書將會使用 GNU C Compiler（通常簡稱為 GCC）作為標準並相容於 LLVM C Frontend（通常簡稱為 Clang）

對於系統的環境安裝與設定，可以參閱 [附錄 A：系統環境安裝與建置](./appendix-01-environment.md)
:::

在編譯完成之後，應該會在相同目錄下見到 `a.out` 的可執行程式，執行 `a.out` 即可在螢幕上顯示 `Hello World`

### 1.1.3 程式碼解說

```c
#include <stdio.h>

int main() {
    puts("Hello World");
}
```

C 語言存在一個特殊的 _函式（Function）_ 稱為 `main` 函式（行3），所有的可執行程式都是由 `main` 函式作為起點。

函式將會被一對花括號 `{}` 包裏，代表的是這個函式實際會被執行哪些 _陳述式（Statement）_ 或運算。

程式設計師有的時候會調用其它函式來幫助他們完成某些工作，被調用的函式可以是自行編寫或是來自於其它先進們所編寫的函式庫。在上述程式碼中，我們使用了 `#include <stdio.h>`，其作用就是告知編譯器我們將會使用標準輸入輸出函式庫。

在 `main` 函式中，我們使用了 `puts` 函式，這就是被定義於 `stdio.h` 的標準輸出函式之一。

為了在函式之間交換資訊，一個常見的做法是使用 _參數（Parameter）_，我們可以觀察到 `main` 函式並不存在任何的參數，而 `puts` 函式中則有一個 `"Hello World"` 參數；用 `""` 包裏的內容通常被稱為 _字串（String）_。

## 1.2 變數與算術表達式

讓我們來看下一個程式：攝氏與華氏轉換器。理想上，它應該可以輸出如下列的溫度對照表：

```
0   32
10  50
20  68
30  86
40  104
50  122
```

我們已知攝氏溫度與華氏溫度的轉換公式為：

$$^\circ\text{F} = ^\circ\text{C} * \frac{9}{5} + 32$$

有了以上的知識，我們可以撰寫以下程式碼，這個程式碼相較於之前的 `Hello World` 稍微長了一些，但並不複雜，並且我們會在這個程式中引入一些新的概念，包括註釋、宣告、常數、變數與算術表達式、循環與格式化輸出。

```c
#include <stdio.h>

#define LOWER 0  // 表達溫度表的下限
#define UPPER 50 // 表達溫度表的上限
#define STEP 10  // 表達溫度表每次會遞增多少度

/* 
 * 當 celsius = 0, 10, ..., 50 時，
 * 分別印出攝氏與華氏溫度對照表
 */
int main() {
    int fahr, celsius;

    celsius = LOWER;
    while (celsius <= UPPER) {
        fahr = celsius * 9 / 5 + 32;
        printf("%d\t%d\n", celsius, fahr);
        celsius = celsius + STEP;
    }
}
```

### 1.2.1 註釋

我們率先看到第 3, 4, 5 行，位於 `//` 之後的內容表示 _註釋（Comment）_，註釋可以是任何內容，編譯器會自動忽略 `//` 之後的文字直到換行為止。

在第 7 ~ 10 行中，使用了 `/**/` 包裏了一段文字，這是另一種註釋形式，它能夠包含多行內容。

:::info
儘管在標準上註釋並不限制使用什麼文字或語言撰寫，但習慣上大部份程式設計師仍會使用英文作為溝通的標準。
:::

### 1.2.2 常數

在 C 語言中，可以使用 `#define` 來定義 _常數（Constant）_，在上述程式中我們定義了三個常數：

```c
#define LOWER 0
#define UPPER 50
#define STEP 10
```

編譯器在 _前置處理（Preprocessing）_ 的過程中，會將常數填入回程式碼中，也就是說上述程式碼完全等價於以下程式碼，程式設計師往往會為了可讀性與可複用性來使用 `#define` 來定義常數。

```c
#include <stdio.h>

int main() {
    int fahr, celsius;

    celsius = 0;
    while (celsius <= 50) {
        fahr = celsius * 9 / 5 + 32;
        printf("%d\t%d\n", celsius, fahr);
        celsius = celsius + 10;
    }
}
```

### 1.2.3 變數

在第 12 行中，使用 `int fahr, celsius;` 宣告 _整數（Integer）_ 變數，而變數通常用於暫存即將會被使用到的資料。

在 C 語言中，變數必須先宣告才能使用，而宣告通常被放置在函式的起始處，位於任何可執行程式之前。

在變數宣告時，程式設計師必須先指定其資料型態，例如在此處使用 `int` 代表宣告的是整數變數。

C 語言內建了一些資料型態用於表示不同的資料類型，例如上面用到的 `int` 代表整數，或是與其相對應的 `float` 代表浮點數（通常是指帶小數點的數或指數），我們會在後續的章節中詳細討論這些資料型態。

### 1.2.4 迴圈

計算機相較於人類有著一大優勢在於它能夠重複地執行有規則的計算，而迴圈就是它的具體實踐。

在第 15 行中，我們使用了 `while` 迴圈：

```c
while (celsius <= UPPER) {
    // ...
}
```

`while` 迴圈是按照以下規則運作的：測試 `()` 內的條件，如果成立則執行循環體（`{}` 包裏的內容被稱為循環體），並且會重複執行直到條件不成立為止。

當條件不成立，則會跳過整個循環體然後執行下一個陳述式，因為目前的程式碼在 `while` 迴圈之後沒有其它陳述式，程式到此結束。

:::info
若循環體只有一個陳述式，則 `{}` 是可以省略的，例如：

```c
while (i < 10)
    i = i * 2;
```

可以觀察到，在循環體中會加入一些空白，這樣就可以很容易地看出程式碼的邏輯結構。

編譯器並不關心程式碼的外觀，但是正確的格式有助於增加程式的可讀性以及增加其它人協作的便利性。
:::

### 1.2.5 算術表達式與賦值

在上述的程式碼中，最核心的部份當屬第 16 行循環體中的陳述式：

```c
fahr = celsius * 9 / 5 + 32;
```

用於計算指定的攝氏溫度對應的華氏溫度，並且將結果 _賦值（Assignment）_ 給變數 `fahr`。

可以注意到，這裡用了 `celsius * 9 / 5`，而不是 `9 / 5 * celsius`，這是因為 C 語言的算術遵循數學的基本規則「先乘除後加減」，但是整數運算的除法會把小數部份捨棄，因此 `9 / 5 * celsius` 會等於 `1 * celsius`。

### 1.2.6 格式化輸出

不同於上一節使用 `puts` 輸出，這裡使用了 `printf` 函式。

`printf` 是一個通用格式化輸出函式，該函式允許一個以上的參數，其中第一個參數是輸出的字串格式，其中的每個 `%` 表示其後續的參數進行替換的位置。

```c
printf("%d\t%d\n", celsius, fahr);
```

其中 `%d` 指定一個整數參數，因為在格式中存在 2 個 `%d`，因此後面需要指定兩個整數 `celsius` 與 `fahr` 作為 `printf` 的參數。在使用 `printf` 時必需特別注意，參數的資料型態與數量都必需配對，否則將會出現錯誤的結果。

與 `puts` 不同的是，由 `printf` 輸出的內容並不會自動換行，因此必需在後面加上 `\n` 指示輸出字串需要換行，我們將這些有特殊作用的字元稱為 _逃脫字元（Escape Character）_。不難注意到，上述的程式在兩個 `%d` 中間也加入了一個 `\t`，這是一個製表符逃脫字元，表示這之間要留一個製表符的空間。

:::info
`puts` 與 `printf` 函式並不是 C 語言本身的一部份，C 語言本身並沒有定義輸入與輸出功能。它們僅僅只是標準函式庫 `stdio.h` 中一個有用的函式，這些標準函式在 C 語言程式碼中通常都可以使用，因為 ANSI 標準規範了 `printf` 與 `puts` 函式的行為，對於任何符合該標準的編譯器與函式庫而言，這些函式都應該存在相同的行為。
:::

現在的程式存在一個小毛病：輸出的數字不是向右對齊的，這導致輸出結果不太美觀。

所幸只要在 `printf` 函式中的第一個參數 `%d` 中指出寬度，輸出的結果將會向右對齊，例如我們把它改成：

```c
printf("%2d\t%3d\n", celsius, fahr);
```

這樣 `celsius` 佔 2 字寬、`fahr` 佔 3 字寬，輸出的結果如下所示：

```
 0	 32
10	 50
20	 68
30	 86
40	104
50	122
```

## 1.3 for 陳述式

對於某些特定的任務，往往都有多種不同的解決方案。下述的程式碼也可以實現在 1.2 節中提到的攝氏華氏轉換程式：

```c
#include <stdio.h>

#define LOWER 0
#define UPPER 50
#define STEP 10

int main() {
    for (int celsius = LOWER; celsius <= UPPER; celsius += STEP) {
        int fahr = celsius * 9 / 5 + 32;
        printf("%2d\t%3d\n", celsius, fahr);
    }
}
```

`for` 陳述式是另一種循環實踐方式，可以想成是對 `while` 的擴充。相較於 `while`，會發現 `for` 的操作上更加直觀一些。

在 `for` 的 `()` 中可以用 `;` 分為三個部份：
- `int celsius = LOWER` 初始化：只有在進入循環之前執行一次 
- `celsius <= UPPER` 條件測試：在每一次循環開始之前都會確認，如果符合條件則執行循環體 
- `celsuius += STEP` 後處理：在每次循環體結束之後就會執行一次

:::info
你可能有注意到，在 1.2.3 中我們曾經提到過：
> 在 C 語言中，變數必須先宣告才能使用，而宣告通常被放置在函式的起始處，位於任何可執行程式之前。

而在本章中的寫法並不符合這樣的規則，因為在 `for` 的初始化時才宣告了 `celsius` 變數，甚至是在循環體中才宣告了 `fahr` 變數。

這麼做的理由是因為有時候程式設計師會希望特定的變數只在某些區域可以使用，從而避免影響到其它的區塊。
:::

在實際的程式設計過程中，可以自由選擇 while 或 for 中任意一種，主要取決於哪種方式更加清晰。

